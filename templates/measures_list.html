{% extends "base.html" %}
{% load static %}
{% load django_vite %}

{% block head %}
    {% if user.is_authenticated %}
    {% vite_asset 'src/components/measures/MeasuresList.svelte' %}
    {% endif %}
{% endblock %}

{% block title %}{% if preview_mode %}Measure Previews{% else %}Measures{% endif %}{% endblock %}
{% block content %}

<div class="container xl:max-w-screen-xl pt-2 md:pt-6 pb-4">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
        <!-- Header Section -->
        <div class="mb-4">
            <div class="flex flex-wrap items-center justify-between gap-4 mb-6">
                <h1 class="text-4xl font-bold text-gray-900 tracking-tight">
                    {% if preview_mode %}Measure Previews{% else %}Measures{% endif %}
                </h1>
                {% if user.is_authenticated %}
                    {% if preview_mode %}
                    <a href="{% url 'viewer:measures_list' %}" class="inline-flex items-center gap-2 px-4 py-2 text-sm font-medium text-gray-700 bg-gray-50 border border-gray-200 rounded-lg hover:bg-gray-100 hover:border-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18" />
                        </svg>
                        Back to measures
                    </a>
                    {% else %}
                    <a href="{% url 'viewer:measures_preview_list' %}" class="inline-flex items-center gap-2 px-4 py-2 text-sm font-medium text-blue-700 bg-blue-50 border border-blue-200 rounded-lg hover:bg-blue-100 hover:border-blue-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178Z" />
                            <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
                        </svg>
                        View preview measures
                    </a>
                    {% endif %}
                {% endif %}
            </div>
            <p class="text-lg text-gray-600 mb-4 leading-relaxed">
                Measures are pre-built analyses of medicines use in hospitals. They provide valuable insights into areas such as cost-effectiveness, patient safety, and adherence to best practices.
            </p>
            <div class="bg-amber-50 border-l-4 border-amber-400 p-4 mb-2" role="alert">
                <div class="flex">
                    <div class="flex-shrink-0">
                        <svg class="h-5 w-5 text-amber-400" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
                        </svg>
                    </div>
                    <div class="ml-3">
                        {% if preview_mode %}
                        <h3 class="text-sm font-medium text-amber-800">Preview Measures Warning</h3>
                        <div class="mt-2 text-sm text-amber-700">
                            <p>These measures are in preview and may not be fully developed or validated. They are provided for early feedback and testing purposes.
                            The text, products selected, and data shown may be incorrect or incomplete. They should not be used for decision making.</p>
                        </div>
                        {% else %}
                        <p class="text-sm text-amber-700">Just because an NHS Trust is an outlier for high or low use, that doesn't necessarily mean they are good or bad. These are measures rather than indicators, and they need to be interpreted judiciously.</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        {% if user.is_authenticated %}
        <measures-list
            measures="{{ measures_json|default:'[]' }}"
            previewMeasures="{{ preview_measures_json|default:'[]' }}"
            inDevelopmentMeasures="{{ in_development_measures_json|default:'[]' }}"
            chartData="{{ chart_data_json|default:'{}' }}"
            previewMode="{{ preview_mode|yesno:'true,false' }}"
            userAuthenticated="true"
            measureTrustsBasePath="{{ measure_trusts_base_path|default:'/measures/' }}"
            orgData="{{ org_data_json }}"
            regionData="{{ region_data_json }}"
            tagsData="{{ tags_json|default:'[]' }}"
            initialMode="{{ selected_mode|default:'trust' }}"
            initialCode="{{ selected_code|default:'' }}"
            initialSort="{{ selected_sort|default:'name' }}"
            initialTags="{{ selected_tag|default:'' }}"
        ></measures-list>
        {% else %}
        {% if not preview_mode and measures %}
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
            {% for measure in measures %}
                {% include "partials/_measure_card_simple.html" with detail_url_name="viewer:measure_item" link_classes="bg-oxford-50 text-oxford-600 hover:bg-oxford-100" link_text="View measure" %}
            {% endfor %}
        </div>
        {% endif %}

        {% if preview_measures %}
        <div class="mb-12">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                {% for measure in preview_measures %}
                    {% include "partials/_measure_card_simple.html" with detail_url_name="viewer:measure_preview_item" card_header_class="bg-blue-50 py-2 px-4 border-b border-gray-100" status_badge="Preview" status_badge_class="bg-blue-100 text-blue-800" link_classes="bg-blue-50 text-blue-600 hover:bg-blue-100" link_text="View preview" %}
                {% endfor %}
            </div>
        </div>
        {% endif %}

        {% if in_development_measures %}
        <div class="mb-12">
            <h2 class="text-2xl font-semibold mb-6 text-gray-900">In Development</h2>
            <p class="text-gray-600 mb-6">These measures are currently in development. Public previews are not available for these measures. You can see them because you are logged in.</p>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                {% for measure in in_development_measures %}
                    {% include "partials/_measure_card_simple.html" with detail_url_name="viewer:measure_preview_item" card_header_class="bg-amber-50 py-2 px-4 border-b border-gray-100" status_badge="ðŸš§ In development" status_badge_class="bg-amber-100 text-amber-800" link_classes="bg-amber-50 text-amber-600 hover:bg-amber-100" link_text="View in development" %}
                {% endfor %}
            </div>
        </div>
        {% endif %}
        {% endif %}

    </div>
</div>

{% endblock %}
